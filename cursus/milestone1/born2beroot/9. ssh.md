#### NAT,  ポートフォワーディング
- **NAT (Network Address Translation)**
  IPアドレスを変換する技術。プライベートIPアドレス↔グローバルIPアドレス。
  グローバルIPアドレスをすべての機器に付与していたら枯渇するので、節約のためにプライベートIPアドレスが必要。
  LAN（Local Aria Network）からインターネットにつながるときプライベートからグローバルの変換が必要で、それを実現するのがNAT。
- **NATの弊害**
  プライベート->グローバルの変換はできるが、グローバル->プライベートの変換をする際に、どの機器に向けたパケットかわからないので変換できない。
- **ポートフォワーディング**
  インターネットから特定のポート番号宛に通信が届いたとき、特定の機器にパケットを転送する機能。
  たとえば、宛先ポートが80番のパケットはプライベートアドレス192.168.1.1の機器に転送するなど。
##### 仮想マシンにおけるNAT, ブリッジ接続
- 仮想マシンにはNATモードがあり、ホストPCがNAT変換をおこなうことで、仮想マシンはホストPCのプライベートアドレスをもって外部ネットワークと接続する。
- ブリッジ接続をすると、ホストPCと同じ物理ネットワークに直接接続するので、独立したひとつのマシンのようにふるまう。

https://wiki.archlinux.jp/index.php/OpenSSH

パッケージ名`openssh-server`
sshの設定 : `/etc/ssh/ssh_config`
デーモンの設定 : `/etc/ssh/sshd_config`
自機のグローバル/プライベートIPアドレス確認  : `ip a`
`ssh <接続先ユーザ名>@<接続先IPアドレス> -p <ポート番号>` : ssh接続



#### systemctl status ssh の内容

アクセス履歴に表示されるポート番号がsshで許可したポート番号と異なるのはなぜですか

これは **正常な動作** であり、表示されている「port 53422」は **クライアント側（接続元）のポート番号** だからです。

---

## ✅ 理由：SSH ログに出る「port」はクライアント側のポート

SSH ログの形式：

```
Accepted password for <user> from <接続元IP> port <接続元ポート>
```

ここでの **port 53422** は、  
SSH クライアント（例：192.168.1.10）が通信に使用した **エフェメラルポート（動的ポート）** です。

### 🔹 つまり：

- **あなたの SSH サーバが LISTEN しているポート**：通常 22（設定で変更可能）
    
- **クライアントが接続に使うポート**：49152～65535 の範囲などの適当な空きポート
    

SSH 接続では、  
**サーバは固定ポート（22）**  
**クライアントは毎回違うランダムなポート**  
を使うのが一般的です。

---

## 💡 なぜクライアントはランダムなポートを使うの？

TCP 通信の仕様で、クライアントは接続ごとに  
**エフェメラルポート** と呼ばれる一時ポートを自動的に割り当てるためです。

これによって、

- 同一サーバへの複数接続が可能
    
- 衝突を避ける
    
- OS が安全にポート管理できる
    

といったメリットがあります。

---

## 🔍 確認例（サーバ側で LISTEN ポートを見る）

```
ss -tlnp | grep sshd
```

例：

```
LISTEN  0  128  0.0.0.0:22   0.0.0.0:*   users:(("sshd",pid=1234,fd=3))
```

---

## 📌 まとめ

ログに出るポート番号があなたが許可した SSH ポートと異なるのは、  
**それがクライアント側の動的ポート番号であり、サーバ側の設定とは無関係**  
だからです。

必要であれば、

- サーバ側がどのポートを LISTEN しているかの確認方法
    
- ファイアウォールでの SSH 許可ポート設定の確認  
    なども説明できますよ。


